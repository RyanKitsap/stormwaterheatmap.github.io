geom_vline(xintercept = threshMin, linetype = 2) + geom_text(
aes(
x = threshMin,
y = .33,
angle = 90,
label = "low-flow threshold"
),
nudge_x = -1.5,
hjust = "left",
color = "#323232"
) +
geom_vline(xintercept = threshMax, linetype = 2) + geom_text(
aes(
x = threshMax,
y = .33,
angle = 90,
label = "high-flow threshold"
),
nudge_x = -1.5,
hjust = "left",
color = "#323232"
) + theme(legend.position = "none",
panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
#axis.ticks.x=element_blank(),
axis.line = element_line(linetype =1),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank())+scale_color_ipsum()+scale_fill_ipsum()+xlab("Discharge")+ylab("Exceedance Probability")+scale_y_continuous(expand = c(0,0),limits = c(0,NA))
ggplot(exampleFlowDuration) +
geom_ribbon(data = fdurSubset, aes(ymin = 0, ymax = P, x = Q,fill=(Scenario)),alpha = 0.2,palette=ipsum_pal)+facet_wrap(~Scenario,as.table = FALSE)+
geom_line(aes(x = Q, y = P, color = Scenario)) +
geom_vline(xintercept = threshMin, linetype = 2) + geom_text(
aes(
x = threshMin,
y = .33,
angle = 90,
label = "low-flow threshold"
),
nudge_x = -1.5,
hjust = "left",
color = "#323232"
) +
geom_vline(xintercept = threshMax, linetype = 2) + geom_text(
aes(
x = threshMax,
y = .33,
angle = 90,
label = "high-flow threshold"
),
nudge_x = -1.5,
hjust = "left",
color = "#323232"
) + theme(legend.position = "none",
panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
#axis.ticks.x=element_blank(),
axis.line = element_line(linetype =1),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank())+scale_color_ipsum()+scale_fill_ipsum()+xlab("Discharge")+ylab("Exceedance Probability")+scale_y_continuous(expand = c(0,0),limits = c(0,NA))
ggplot(exampleFlowDuration) +
geom_ribbon(data = fdurSubset, aes(ymin = 0, ymax = P, x = Q,fill=(Scenario)),alpha = 0.2,palette=ipsum_pal)+facet_wrap(~Scenario,as.table =TRUE)+
geom_line(aes(x = Q, y = P, color = Scenario)) +
geom_vline(xintercept = threshMin, linetype = 2) + geom_text(
aes(
x = threshMin,
y = .33,
angle = 90,
label = "low-flow threshold"
),
nudge_x = -1.5,
hjust = "left",
color = "#323232"
) +
geom_vline(xintercept = threshMax, linetype = 2) + geom_text(
aes(
x = threshMax,
y = .33,
angle = 90,
label = "high-flow threshold"
),
nudge_x = -1.5,
hjust = "left",
color = "#323232"
) + theme(legend.position = "none",
panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
#axis.ticks.x=element_blank(),
axis.line = element_line(linetype =1),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank())+scale_color_ipsum()+scale_fill_ipsum()+xlab("Discharge")+ylab("Exceedance Probability")+scale_y_continuous(expand = c(0,0),limits = c(0,NA))
```
$$\ln\left[\sum_{q_{low}}^{q_{high}}F(Q_{post}) - F(Q_{pre}) \right]$$
```{r fig.height=7}
runoffPlots <- function (gridName, cigPrecip.df,location) {
BQ_runoff <- subset(AnnualQEverettSeatacTacoma, grid == gridName,)
head(BQ_runoff)
summaryP <-
(dplyr::select(BQ_runoff, starts_with("hru")) / cigPrecip.df$x) %>%
cbind(years) %>%
pivot_longer(cols = starts_with("hru"),
names_to = "hru",
values_to = "Q.mm") %>%
merge(hrus, by.x = "hru", by.y = "name")
outwash = subset(summaryP, Soil ==
"Outwash")
Saturated = subset(summaryP, Soil ==
"Saturated")
Till = subset(summaryP, Soil ==
"Till")
impervious = subset(summaryP, Landuse ==
"Impervious")
titlepart = paste("HSPY model results - ",location,", WA \nRunoff as a percentage of rainfall")
qplots <- ggplot(summaryP) +
geom_col(aes(x = years, y = Q.mm), fill = "cadetblue", position = "dodge") +
facet_grid(Landuse ~ Slope) +
scale_y_continuous(labels = scales::percent_format(accuracy = 0.01)) +
ylab("Annual runoff / Annual Precipitation") +
labs(subtitle = titlepart) +
theme_ipsum()
return(list(qplots %+% outwash + ggtitle("Outwash Soils"),
qplots %+% Till + ggtitle("Till Soils"),
qplots %+% Saturated + ggtitle("Saturated Soils"),
qplots %+% impervious + ggtitle("Impervious")))
}
`
seatac <- read.delim("~/repos/stormwaterheatmap-master/hydrology/data/seatac_daily_precip.txt", stringsAsFactors=FALSE)
seatac$year <- strtrim(seatac$Date, 4)
start = 7763
seatac_subset <- seatac[start:(start + 10949),]
head(seatac_subset)
seatac_subset$mm <- seatac_subset$X2.in * 25.4
Cig_seatac_Precip <- read_csv("~/repos/stormwaterheatmap-master/hydrology/data/ID16_V7_precip.csv")
Cig_seatac_Precip$year <- seatac_subset$year
#precipCompare(seatac_subset,Cig_seatac_Precip)
gridName="ID16_V7"
Cig_seatac_Precip.yearly=Cig_seatac_Precip%>% group_by(year)  %>% mutate(sum = sum(x))
Cig_seatac_Precip.yearly.df <- data.frame(year = unique(Cig_seatac_Precip.yearly$year),x = unique(Cig_seatac_Precip.yearly$sum))
qPlots <- runoffPlots("ID16_V7",Cig_seatac_Precip.yearly.df,"Seatac Airport")
qPlots[[1]]
qPlots <- runoffPlots("ID16_V7",Cig_seatac_Precip.yearly.df,"Seatac Airport")
qPlots[[1]]
qPlots
gridName
qPlots <- runoffPlots("ID16_V7",Cig_seatac_Precip.yearly.df,"Seatac Airport")
runoffPlots <- function (gridName, cigPrecip.df,location) {
BQ_runoff <- subset(AnnualQEverettSeatacTacoma, grid == gridName,)
head(BQ_runoff)
summaryP <-
(dplyr::select(BQ_runoff, starts_with("hru")) / cigPrecip.df$x) %>%
cbind(years) %>%
pivot_longer(cols = starts_with("hru"),
names_to = "hru",
values_to = "Q.mm") %>%
merge(hrus, by.x = "hru", by.y = "name")
outwash = subset(summaryP, Soil ==
"Outwash")
Saturated = subset(summaryP, Soil ==
"Saturated")
Till = subset(summaryP, Soil ==
"Till")
impervious = subset(summaryP, Landuse ==
"Impervious")
titlepart = paste("HSPY model results - ",location,", WA \nRunoff as a percentage of rainfall")
qplots <- ggplot(summaryP) +
geom_col(aes(x = years, y = Q.mm), fill = "cadetblue", position = "dodge") +
facet_grid(Landuse ~ Slope) +
scale_y_continuous(labels = scales::percent_format(accuracy = 0.01)) +
ylab("Annual runoff / Annual Precipitation") +
labs(subtitle = titlepart) +
theme_ipsum()
return(list(qplots %+% outwash + ggtitle("Outwash Soils"),
qplots %+% Till + ggtitle("Till Soils"),
qplots %+% Saturated + ggtitle("Saturated Soils"),
qplots %+% impervious + ggtitle("Impervious")))
}
hrus <- read_csv("~/repos/stormwaterheatmap-master/hydrology/data/hrus.csv")
AnnualQEverettSeatacTacoma <-read_csv("~/repos/stormwaterheatmap-master/hydrology/data/AnnualPrecipEverettSeatacTacoma.csv")
years = seq(1970,1999,1)
seatac <- read.delim("~/repos/stormwaterheatmap-master/hydrology/data/seatac_daily_precip.txt", stringsAsFactors=FALSE)
seatac$year <- strtrim(seatac$Date, 4)
start = 7763
seatac_subset <- seatac[start:(start + 10949),]
head(seatac_subset)
seatac_subset$mm <- seatac_subset$X2.in * 25.4
Cig_seatac_Precip <- read_csv("~/repos/stormwaterheatmap-master/hydrology/data/ID16_V7_precip.csv")
Cig_seatac_Precip$year <- seatac_subset$year
#precipCompare(seatac_subset,Cig_seatac_Precip)
gridName="ID16_V7"
Cig_seatac_Precip.yearly=Cig_seatac_Precip%>% group_by(year)  %>% mutate(sum = sum(x))
Cig_seatac_Precip.yearly.df <- data.frame(year = unique(Cig_seatac_Precip.yearly$year),x = unique(Cig_seatac_Precip.yearly$sum))
qPlots <- runoffPlots("ID16_V7",Cig_seatac_Precip.yearly.df,"Seatac Airport")
runoffPlots <- function (gridName, cigPrecip.df,location) {
BQ_runoff <- subset(AnnualQEverettSeatacTacoma, grid == gridName,)
head(BQ_runoff)
summaryP <-
(dplyr::select(BQ_runoff, starts_with("hru")) / cigPrecip.df$x) %>%
cbind(years) %>%
pivot_longer(cols = starts_with("hru"),
names_to = "hru",
values_to = "Q.mm") %>%
merge(hrus, by.x = "hru", by.y = "name")
outwash = subset(summaryP, Soil ==
"Outwash")
Saturated = subset(summaryP, Soil ==
"Saturated")
Till = subset(summaryP, Soil ==
"Till")
impervious = subset(summaryP, Landuse ==
"Impervious")
titlepart = paste("HSPY model results - ",location,", WA \nRunoff as a percentage of rainfall")
qplots <- ggplot(summaryP) +
geom_col(aes(x = years, y = Q.mm), position = "dodge") +
facet_grid(Landuse ~ Slope) +
scale_y_continuous(labels = scales::percent_format(accuracy = 0.01)) +
ylab("Annual runoff / Annual Precipitation") +
labs(subtitle = titlepart) +
theme_ipsum()+scale_color_ipsum()+scale_fill_ipsum()
return(list(qplots %+% outwash + ggtitle("Outwash Soils"),
qplots %+% Till + ggtitle("Till Soils"),
qplots %+% Saturated + ggtitle("Saturated Soils"),
qplots %+% impervious + ggtitle("Impervious")))
}
p <- plot %+% subset(Q, Soil =="Outwash",)+ggtitle("Outwash Soils")+scale_y_log10()
p
plot <- ggplot(subset(Q, Landuse %in% c("Impervious")),)+geom_boxplot(aes(x=Slope,y=MeanQ, fill = Slope),alpha=0.8)+facet_wrap(vars(Soil))+scale_y_log10()+ylab("Mean Annual Runoff (mm/year) 1970-1999")++scale_color_ipsum()+scale_fill_ipsum()
plot
library(knitr)
library(rmdformats)
library(hrbrthemes)
library(tidyverse)
library(ggridges)
### Global options
options(warning = FALSE,message = FALSE,echo=FALSE)
opts_chunk$set(echo=FALSE,
message=FALSE,
warning=FALSE)
opts_knit$set(warning = FALSE,message = FALSE,echo=FALSE)
## ggploting theme
theme_set(hrbrthemes::theme_ipsum_rc())
hrbrthemes::import_roboto_condensed()
hrbrthemes::update_geom_font_defaults()
knitr::include_graphics('images/hspf_perlnd.png')
soilsparams <- read_csv("~/repos/stormwaterheatmap-master/R-scripts/WatershedRegression/data/soilsparams.csv")%>%
pivot_wider(names_from = Veg, values_from = Value)
DT::datatable(soilsparams)
knitr::include_graphics('qgis/for_figure.png')
runoffPlots <- function (gridName, cigPrecip.df,location) {
BQ_runoff <- subset(AnnualQEverettSeatacTacoma, grid == gridName,)
head(BQ_runoff)
summaryP <-
(dplyr::select(BQ_runoff, starts_with("hru")) / cigPrecip.df$x) %>%
cbind(years) %>%
pivot_longer(cols = starts_with("hru"),
names_to = "hru",
values_to = "Q.mm") %>%
merge(hrus, by.x = "hru", by.y = "name")
outwash = subset(summaryP, Soil ==
"Outwash")
Saturated = subset(summaryP, Soil ==
"Saturated")
Till = subset(summaryP, Soil ==
"Till")
impervious = subset(summaryP, Landuse ==
"Impervious")
titlepart = paste("HSPY model results - ",location,", WA \nRunoff as a percentage of rainfall")
qplots <- ggplot(summaryP) +
geom_col(aes(x = years, y = Q.mm), position = "dodge") +
facet_grid(Landuse ~ Slope) +
scale_y_continuous(labels = scales::percent_format(accuracy = 0.01)) +
ylab("Annual runoff / Annual Precipitation") +
labs(subtitle = titlepart) +
theme_ipsum()+scale_color_ipsum()+scale_fill_ipsum()
return(list(qplots %+% outwash + ggtitle("Outwash Soils"),
qplots %+% Till + ggtitle("Till Soils"),
qplots %+% Saturated + ggtitle("Saturated Soils"),
qplots %+% impervious + ggtitle("Impervious")))
}
hrus <- read_csv("~/repos/stormwaterheatmap-master/hydrology/data/hrus.csv")
AnnualQEverettSeatacTacoma <-read_csv("~/repos/stormwaterheatmap-master/hydrology/data/AnnualPrecipEverettSeatacTacoma.csv")
years = seq(1970,1999,1)
seatac <- read.delim("~/repos/stormwaterheatmap-master/hydrology/data/seatac_daily_precip.txt", stringsAsFactors=FALSE)
seatac$year <- strtrim(seatac$Date, 4)
start = 7763
seatac_subset <- seatac[start:(start + 10949),]
head(seatac_subset)
seatac_subset$mm <- seatac_subset$X2.in * 25.4
Cig_seatac_Precip <- read_csv("~/repos/stormwaterheatmap-master/hydrology/data/ID16_V7_precip.csv")
Cig_seatac_Precip$year <- seatac_subset$year
#precipCompare(seatac_subset,Cig_seatac_Precip)
gridName="ID16_V7"
Cig_seatac_Precip.yearly=Cig_seatac_Precip%>% group_by(year)  %>% mutate(sum = sum(x))
Cig_seatac_Precip.yearly.df <- data.frame(year = unique(Cig_seatac_Precip.yearly$year),x = unique(Cig_seatac_Precip.yearly$sum))
qPlots <- runoffPlots("ID16_V7",Cig_seatac_Precip.yearly.df,"Seatac Airport")
qPlots[[1]]
qPlots[[2]]
qPlots[[3]]
qPlots[[4]]
runoffPlots <- function (gridName, cigPrecip.df,location) {
BQ_runoff <- subset(AnnualQEverettSeatacTacoma, grid == gridName,)
head(BQ_runoff)
summaryP <-
(dplyr::select(BQ_runoff, starts_with("hru")) / cigPrecip.df$x) %>%
cbind(years) %>%
pivot_longer(cols = starts_with("hru"),
names_to = "hru",
values_to = "Q.mm") %>%
merge(hrus, by.x = "hru", by.y = "name")
outwash = subset(summaryP, Soil ==
"Outwash")
Saturated = subset(summaryP, Soil ==
"Saturated")
Till = subset(summaryP, Soil ==
"Till")
impervious = subset(summaryP, Landuse ==
"Impervious")
titlepart = paste("HSPY model results - ",location,", WA \nRunoff as a percentage of rainfall")
qplots <- ggplot(summaryP) +
geom_col(aes(x = years, y = Q.mm), position = "dodge") +
facet_grid(Landuse ~ Slope) +
scale_y_continuous(labels = scales::percent_format(accuracy = 0.01)) +
ylab("Annual runoff / Annual Precipitation") +
labs(subtitle = titlepart) +
theme_ipsum()+scale_color_ipsum()+scale_fill_ipsum()
return(list(qplots %+% outwash + ggtitle("Outwash Soils"),
qplots %+% Till + ggtitle("Till Soils"),
qplots %+% Saturated + ggtitle("Saturated Soils"),
qplots %+% impervious + ggtitle("Impervious")))
}
library(bigrquery)
library(tidyverse)
quant_sql <- "
SELECT
grid,
SUM(hru000)/30 AS hru000,
SUM(hru001)/30 AS hru001,
SUM(hru002)/30 AS hru002,
SUM(hru010)/30 AS hru010,
SUM(hru011)/30 AS hru011,
SUM(hru012)/30 AS hru012,
SUM(hru020)/30 AS hru020,
SUM(hru021)/30 AS hru021,
SUM(hru022)/30 AS hru022,
SUM(hru100)/30 AS hru100,
SUM(hru101)/30 AS hru101,
SUM(hru102)/30 AS hru102,
SUM(hru110)/30 AS hru110,
SUM(hru111)/30 AS hru111,
SUM(hru112)/30 AS hru112,
SUM(hru120)/30 AS hru120,
SUM(hru121)/30 AS hru121,
SUM(hru122)/30 AS hru122,
SUM(hru200)/30 AS hru200,
SUM(hru201)/30 AS hru201,
SUM(hru202)/30 AS hru202,
SUM(hru210)/30 AS hru210,
SUM(hru211)/30 AS hru211,
SUM(hru212)/30 AS hru212,
SUM(hru220)/30 AS hru220,
SUM(hru221)/30 AS hru221,
SUM(hru222)/30 AS hru222,
SUM(hru250)/30 AS hru250,
SUM(hru251)/30 AS hru251,
SUM(hru252)/30 AS hru252,
FROM
`tnc-data-v1.hydrology.gfdl`
WHERE
year between 1970 and 1999
AND comp != 'agwo'
group by grid
"
billing <- "tnc-data-v1"
tb <- bq_project_query(billing, quant_sql)
meanQ <- bq_table_download(tb, max_results = Inf)
meanQ <- meanQ[meanQ$grid != "",]
hruNames <- read_csv("C:/Users/cnilsen/Documents/repos/stormwaterheatmap/R-scripts/hydrology/data/hrus.csv",
col_names = TRUE)
Q <-   pivot_longer(meanQ, -grid, names_to="hru", values_to="MeanQ")%>%
merge(hruNames,by.x="hru",by.y = "name")
plot <- ggplot(subset(Q, Landuse %in% c("Forest","Lawn","Pasture"),))+
#subset(Q, Soil %in% c("Outwash")),)+
geom_boxplot(#geom_boxplot(
aes(y=MeanQ, x=Slope,fill=Slope),alpha=0.8)+facet_grid(~Landuse)+#scale_y_log10()+
ylab("Mean Annual Runoff (mm/year) 1970-1999")+theme_ipsum()+scale_color_ipsum()+scale_fill_ipsum()
p <- plot %+% subset(Q, Soil =="Outwash",)+ggtitle("Outwash Soils")+scale_y_log10()
p
plot %+% subset(Q, Soil =="Till",)+ggtitle("Till Soils")+scale_y_log10()
plot %+% subset(Q, Soil =="Saturated",)+ggtitle("Saturated Soils")+scale_y_log10()
plot <- ggplot(subset(Q, Landuse %in% c("Impervious")),)+geom_boxplot(aes(x=Slope,y=MeanQ, fill = Slope),alpha=0.8)+facet_wrap(vars(Soil))+scale_y_log10()+ylab("Mean Annual Runoff (mm/year) 1970-1999")++scale_color_ipsum()+scale_fill_ipsum()
plot <- ggplot(subset(Q, Landuse %in% c("Impervious")),)+geom_boxplot(aes(x=Slope,y=MeanQ, fill = Slope),alpha=0.8)+facet_wrap(vars(Soil))+scale_y_log10()+ylab("Mean Annual Runoff (mm/year) 1970-1999")+scale_color_ipsum()+scale_fill_ipsum()
plot
update_geom_font_defaults(family = "Arial Narrow",face = "plain",size=3.5)
exampleFlowDuration <- read_csv("data/exampleFlowDuration_tidy.csv")
head(exampleFlowDuration)
threshMax = 31
threshMin = 8
update_geom_font_defaults()
fdurSubset <-
subset(exampleFlowDuration, Q >= threshMin & Q <= threshMax)
ggplot(exampleFlowDuration) +
geom_ribbon(data = fdurSubset, aes(ymin = 0, ymax = P, x = Q,fill=(Scenario)),alpha = 0.2)+facet_wrap(~Scenario,as.table =TRUE)+
geom_line(aes(x = Q, y = P, color = Scenario)) +
geom_vline(xintercept = threshMin, linetype = 2) + geom_text(
aes(
x = threshMin,
y = .33,
angle = 90,
label = "low-flow threshold"
),
nudge_x = -1.5,
hjust = "left",
color = "#323232"
) +
geom_vline(xintercept = threshMax, linetype = 2) + geom_text(
aes(
x = threshMax,
y = .33,
angle = 90,
label = "high-flow threshold"
),
nudge_x = -1.5,
hjust = "left",
color = "#323232"
) + theme(legend.position = "none",
panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
#axis.ticks.x=element_blank(),
axis.line = element_line(linetype =1),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank())+scale_color_ipsum()+scale_fill_ipsum()+xlab("Discharge")+ylab("Exceedance Probability")+scale_y_continuous(expand = c(0,0),limits = c(0,NA))
p <- plot %+% subset(Q, Soil =="Outwash",)+ggtitle("Outwash Soils")+scale_y_log10()
p
plot+ggtitle("Outwash Soils")+scale_y_log10()
plot+ggtitle("Outwash Soils")+scale_y_log10()+facet_wrap(Soil)
plot+ggtitle("Outwash Soils")+scale_y_log10()+facet_wrap(~Soil)
plot
plot <- ggplot(subset(Q, Landuse %in% c("Forest","Lawn","Pasture"),))+
#subset(Q, Soil %in% c("Outwash")),)+
geom_boxplot(#geom_boxplot(
aes(y=MeanQ, x=Slope,fill=Slope),alpha=0.8)+facet_grid(~Landuse)+#scale_y_log10()+
ylab("Mean Annual Runoff (mm/year) 1970-1999")+theme_ipsum()+scale_color_ipsum()+scale_fill_ipsum()
plot
plot+facet_wrap(Soil)
plot+facet_wrap(~Soil)
plot+facet_wrap(~Soil,scales = "free")
plot+facet_wrap(~Soil,scales = "free")+scale_y_log10()
p
plot+facet_wrap(~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
p <- plot %+% subset(Q, Soil =="Outwash",)+ggtitle("Outwash Soils")
plot+facet_wrap(~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
p
plot+facet_wrap(~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
```{r fig.height=7, fig.width=5}
plot+facet_wrap(~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_wrap(Landuse~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_wrap(Landuse~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_wrap(Landuse~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_wrap(Landuse+Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_wrap(~Landuse+Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_wrap(Landuse~Landuse+Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_wrap(Landuse~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_grid(Landuse~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_wrap(Landuse~Soil,scales = "free")+scale_y_log10()+theme(legend.position = "none")
plot+facet_wrap(Landuse~Soil)+scale_y_log10()+theme(legend.position = "none")
plot <- ggplot(Q)+#subset(Q, Landuse %in% c("Forest","Lawn","Pasture"),))+
#subset(Q, Soil %in% c("Outwash")),)+
geom_boxplot(#geom_boxplot(
aes(y=MeanQ, x=Slope,fill=Slope))+facet_grid(~Landuse)+#scale_y_log10()+
ylab("Mean Annual Runoff (mm/year) 1970-1999")+theme_ipsum()+scale_color_ipsum()+scale_fill_ipsum()
plot+facet_wrap(Landuse~Soil)+scale_y_log10()+theme(legend.position = "none")
plot <- ggplot(subset(Q, Landuse %in% c("Forest","Lawn","Pasture"),))+
#subset(Q, Soil %in% c("Outwash")),)+
geom_boxplot(#geom_boxplot(
aes(y=MeanQ, x=Slope,fill=Slope))+facet_grid(~Landuse)+#scale_y_log10()+
ylab("Mean Annual Runoff (mm/year) 1970-1999")+theme_ipsum()+scale_color_ipsum()+scale_fill_ipsum()
plot <- ggplot(subset(Q, Landuse %in% c("Forest","Lawn","Pasture"),))+
#subset(Q, Soil %in% c("Outwash")),)+
geom_boxplot(#geom_boxplot(
aes(y=MeanQ, x=Slope,fill=Slope))+facet_grid(~Landuse)+#scale_y_log10()+
ylab("Mean Annual Runoff (mm/year) 1970-1999")+theme_ipsum()+scale_color_ipsum()+scale_fill_ipsum()
plot+facet_wrap(Landuse~Soil)+scale_y_log10()+theme(legend.position = "none")
runoffPlots <- function (gridName, cigPrecip.df,location) {
BQ_runoff <- subset(AnnualQEverettSeatacTacoma, grid == gridName,)
head(BQ_runoff)
summaryP <-
(dplyr::select(BQ_runoff, starts_with("hru")) / cigPrecip.df$x) %>%
cbind(years) %>%
pivot_longer(cols = starts_with("hru"),
names_to = "hru",
values_to = "Q.mm") %>%
merge(hrus, by.x = "hru", by.y = "name")
outwash = subset(summaryP, Soil ==
"Outwash")
Saturated = subset(summaryP, Soil ==
"Saturated")
Till = subset(summaryP, Soil ==
"Till")
impervious = subset(summaryP, Landuse ==
"Impervious")
titlepart = paste("HSPY model results - ",location,", WA \nRunoff as a percentage of rainfall")
subPlots <- ggplot(summaryP) +
geom_col(aes(x = years, y = Q.mm), position = "dodge") +
facet_grid(Landuse ~ Slope) +
scale_y_continuous(labels = scales::percent_format(accuracy = 0.01)) +
ylab("Annual runoff / Annual Precipitation") +
labs(subtitle = titlepart) +
theme_ipsum()+scale_color_ipsum()+scale_fill_ipsum()
return(list(subPlots %+% outwash + ggtitle("Outwash Soils"),
subPlots %+% Till + ggtitle("Till Soils"),
subPlots %+% Saturated + ggtitle("Saturated Soils"),
subPlots %+% impervious + ggtitle("Impervious")))
}
hrus <- read_csv("~/repos/stormwaterheatmap-master/hydrology/data/hrus.csv")
