"0","# Do some predictive checks "
"0","# ##### function that returns bayesian plots"
"0","library(bayesplot)"
"0","color_scheme_set(""blue"")"
"0","bayes_plots <- function(fit,coc,df) {"
"0","#fit <- TSSModel"
"0",""
"0","#coc = 'Total Suspended Solids - Water - Total'"
"0",""
"0","#df <- (subset(s8data.wPredictors, parameter == coc)) %>%"
"0"," # add_surv()"
"0","yrep_c <- predict(fit, newdata=df, "
"0","         type=""response"", interval=""confidence"", level=0.9, it=NULL, "
"0","         posterior=""all"", verbose=FALSE, approx=""numerical"")"
"0","yrep_p <- predict(fit, newdata=df, "
"0","         type=""response"", interval=""prediction"", level=0.9, it=NULL, "
"0","         posterior=""all"", verbose=FALSE, approx=""numerical"")"
"0",""
"0","#show uncertainty intervals under esimated posterior density curves "
"0","plot.1 <- mcmc_areas(fit$Sol,prob = 0.80, pprob_outer = 0.95,point_est=""mean"")+ggplot2::labs(title = coc, subtitle   = ""Posterior distributions with medians and 80% intervals"")+scale_color_ipsum()+scale_fill_ipsum()"
"0",""
"0","#generate scatter plot of predictions "
"0",""
"0","colnames(yrep_p) <-  c(""fit.p"", ""lwr.p"", ""upr.p"")"
"0","scatterdata <- cbind(df, yrep_c, yrep_p)"
"0",""
"0","#generate scatter plot of predictions "
"0","plot.2 <- ggplot(scatterdata) + "
"0","  geom_ribbon(aes(ymin = lwr.p, ymax = upr.p, x = fit),fill=""grey"", alpha = 0.5) + "
"0","  geom_ribbon(aes(ymin = lwr, ymax = upr, x = fit), fill = ""grey"", alpha = 0.8) + "
"0","  geom_line(aes(x=fit,y=fit),color=""blue"",linetype=5)+"
"0","  geom_point(aes(x = fit, y = log(concentration)), alpha = 0.5)+"
"0","  ggplot2::labs(x=""yrep"",y=""fit"",title = coc, subtitle   = ""Scatter plot of observed data vs simulated"",caption=""dark shade: confidence intervals \n light shade: prediction intervals"")+scale_color_ipsum()+scale_fill_ipsum()"
"0",""
"0",""
"0","#simulate with 100 draws  "
"0","ysim <- (simulate(fit,nsim = 100))"
"0",""
"0",""
"0","#overlay of predictions "
"0","plot.3<- ppc_dens_overlay(log(df$concentration),t(ysim))+ggplot2::labs(x=""log concentration, Î¼g/L "",title = coc, subtitle   = ""Observed (y) vs. simulated draws (yrep)"")+scale_color_ipsum()+scale_fill_ipsum()"
"0",""
"0",""
"0","return(list(plot.1,plot.2,plot.3))"
"0","}"
